# Identify browser extensions with “Can turnoff malware protections” permissions in endpoints with no tamper protection

## Description

The following query leverages DeviceTvmBrowserExtensionsKB and DeviceTvmBrowserExtensions tables which are available at the Microsoft Defender Vulnerability Management (MDVM) add-on license. Results provided include browser extensions with “Can turnoff malware protections” permissions in endpoints with no tamper protection.
### Microsoft Defender XDR
```
let BrowserExtMalwareProtectionKB = DeviceTvmBrowserExtensionsKB
    | where PermissionName contains "Can turn off malware protections"
    | project ExtensionId, ExtensionName, ExtensionRisk, PermissionName;
let BrowserExtMalwareProtection = DeviceTvmBrowserExtensions
    | project ExtensionId, DeviceId;
let DeviceWoTamperProtection = DeviceTvmSecureConfigurationAssessment
    | where ConfigurationId has "scid-2003"
    | where IsCompliant == "0"
    | where IsApplicable == "1"
    | project DeviceId, DeviceName, OSPlatform, Timestamp;
union BrowserExtMalwareProtection, BrowserExtMalwareProtectionKB,
        DeviceWoTamperProtection
    | summarize by ExtensionId, DeviceId
    | join ( BrowserExtMalwareProtectionKB ) on ExtensionId
    | join kind=rightouter ( BrowserExtMalwareProtection ) on ExtensionId
    | join ( DeviceWoTamperProtection ) on DeviceId
    | summarize DeviceCount=dcount(DeviceName), arg_max(Timestamp, *) by ExtensionName, ExtensionRisk
    | sort by DeviceCount asc, ExtensionRisk
```

### Versioning
| Version       | Date          | Comments                               |
| ------------- |---------------| ---------------------------------------|
| 1.0           | 20/10/2024    | Initial publish                        |
